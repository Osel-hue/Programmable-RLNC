version: '3.8'
services:
    oai-ext-dn:
        privileged: true
        container_name: rfsim5g-oai-ext-dn
        image: oaisoftwarealliance/trf-gen-cn5g:focal
        entrypoint: /bin/bash -c \
              "iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE;"\
              "ip route add 12.1.1.0/24 via 192.168.72.134 dev eth0;"\
              "apt update;"\
              "apt-get install --yes python3;"\
              "apt install --yes build-essential;"\
              "apt-get install --yes libcap-ng-dev;"\
              "apt-get install --yes libpcap-dev; sleep infinity"

        networks:
            traffic_net:
                ipv4_address: 192.168.72.135
        healthcheck:
            test: /bin/bash -c "ping -c 2 192.168.72.134"
            interval: 10s
            timeout: 5s
            retries: 5

networks:
    public_net:
        driver: overlay
        name: rfsim5g-oai-public-net
        external: true
        
    traffic_net:
        driver: overlay
        name: rfsim5g-oai-traffic-net
        external: true
